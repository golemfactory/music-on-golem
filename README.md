# Fullstack app with golem

What would it take to build a fullstack app that offers some kind of service that runs on golem?

Next.js project starter generated by `create-t3-app`

## Setup

1. Create a `.env` based on `.env.example`
1. Install the dependencies
1. Start the database with `docker-compose up` and push the schema with `npm run db:push`
1. Start the dev server with `npm run dev`

If you're using VSCode, you can start the docker compose, drizzle studio and the next.js dev server with the `npm: all` task.

## The interesting bits

Code that is related to golem is in [`server/golem`](/src/server/golem)

The source of the `severyn/musicgen:lite` package can be found [here](/golem/)

Everything else is a standard next.js app.

## Feature list:

- [x] Create global golem client that handles creating works (jobs, tasks; naming is hard)
- [x] Use that global client to create a self-contained work that cleans itself up after finishing and pays it's own invoice
- [x] Add a unique id to the WorkContext
- [x] Retrieve running work from global golem client by it's id
- [x] Cancel running work by it's id

## Issues:

- [x] Golem works ~15% of the time - maybe it's the issue with my image?
- [] Works are stored in memory so reloading the backend during dev makes them not accessible
- [x] (BUG) Cancelling work sends out success event
- [] Custom events are not typescript friendly, ((event as BaseEvent<unknown>).name)
